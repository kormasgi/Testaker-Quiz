<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Study</title>

<link rel="stylesheet" href="style.css">

<style>

/* Button colors */

.blueBtn{
  background:#2563eb;
  color:white;
}

.blueBtn:hover{
  background:#1d4ed8;
}

</style>
</head>

<body>

<header>ğŸ“š Study Center</header>

<main>

<!-- MODE SELECT -->
<div id="modeSelect" class="mode-box">

<h2>Choose Mode</h2>

<button class="blueBtn" type = "button" onclick="startFlash()">ğŸ” Flashcards</button>
<button class="blueBtn" type = "button" onclick="startTest()">ğŸ“ Test</button>
<button class="blueBtn" type = "button" onclick="startSmart()">ğŸ§  Smart Study</button>

</div>


<!-- FLASH -->
<div id="flashMode" class="hidden">

<h2>Flashcards</h2>

<div id="flashCard" class="flash-card" onclick="flip()">
<div class="front"></div>
<div class="back"></div>
</div>

<div id="flashBtns" class="flash-buttons hidden">

<button class="good" type = "button" onclick="markFlash(true)">
âœ… I Knew This
</button>

<button class="bad" type = "button" onclick="markFlash(false)">
âŒ I Didnâ€™t Know
</button>

</div>


<div id="flashEnd" class="hidden">

<button class="blueBtn" type = "button" onclick="reviewFlash()">
ğŸ“Œ Study Unknown
</button>

<button class="blueBtn" type = "button" onclick="startFlash()">
ğŸ” Try Again
</button>

</div>

</div>


<!-- TEST -->
<div id="testMode" class="hidden">

<h2>Test</h2>

<form id="testForm" onsubmit="return false;"></form>


<button
  type="button"
  id="submitBtn"
  class="submit-test blueBtn"
  onclick="submitTest()">

Submit

</button>


<div id="testEnd" class="hidden">

<button class="blueBtn" type = "button" onclick="reviewTest()">
ğŸ“Œ Study Wrong
</button>

<button class="blueBtn" type = "button" onclick="startTest()">
ğŸ” Try Again
</button>

</div>

</div>


<!-- SMART -->
<div id="smartMode" class="hidden">

<h2>ğŸ§  Smart Study</h2>

<div id="smartQ" class="smart-box"></div>

<div id="smartAnswer" class="hidden"></div>

<input id="smartInput" placeholder="Type answer">

<button id="smartBtn"
type = "button"
class="submit-test blueBtn"
onclick="checkSmart()">

Submit

</button>


<button
  type="button"
  id="smartRetry"
  class="blueBtn hidden"
  onclick="startSmart()">

ğŸ” Try Again

</button>

</div>

</main>


<script>

// ---------------- SOUNDS ----------------

const correctSound = new Audio("sounds/correct answer.wav");
const wrongSound   = new Audio("sounds/wrong answer.wav");
const streakLostSound = new Audio("sounds/streak.mp3");

// Allow playback after user interaction
document.addEventListener("click", () => {
  correctSound.play().catch(()=>{});
  correctSound.pause();
  correctSound.currentTime = 0;
}, { once:true });



// ---------------- DATA ----------------

const id =
new URLSearchParams(location.search).get("id");

let quizzes =
JSON.parse(localStorage.getItem("quizzes")||"{}");

let allData = quizzes[id] || [];

let data = [];

let i = 0;

let wrongFlash = [];
let wrongTest = [];

let flashStreak = 0;



// ---------------- SAVE ----------------

function save(){

quizzes[id] = allData;

localStorage.setItem(
"quizzes",
JSON.stringify(quizzes)
);

}



// ---------------- UTIL ----------------

function hideAll(){

["modeSelect","flashMode","testMode","smartMode"]
.forEach(id=>{
document.getElementById(id)
.classList.add("hidden");
});

}


function shuffle(arr){

for(let i=arr.length-1;i>0;i--){

const j=Math.floor(Math.random()*(i+1));

[arr[i],arr[j]]=[arr[j],arr[i]];
}

}



// ---------------- FLASH ----------------

function startFlash(){

hideAll();

data=[...allData];

wrongFlash=[];

flashStreak=0;

shuffle(data);

i=0;

document.getElementById("flashEnd")
.classList.add("hidden");

document.getElementById("flashMode")
.classList.remove("hidden");

showFlash();
}


function showFlash(){

document.getElementById("flashBtns")
.classList.add("hidden");

document.getElementById("flashCard")
.classList.remove("flipped");

document.querySelector(".front").textContent=data[i].q;

document.querySelector(".back").textContent=data[i].a;
}


function flip(){

document.getElementById("flashCard")
.classList.add("flipped");

document.getElementById("flashBtns")
.classList.remove("hidden");
}


function markFlash(ok){

if(ok){

correctSound.play();

flashStreak++;

data[i].score++;

}

else{

wrongSound.play();

if(flashStreak>0) streakLostSound.play();

flashStreak=0;

data[i].score-=2;

wrongFlash.push(data[i]);
}

save();

i++;

if(i>=data.length){

endFlash();

return;
}

showFlash();
}


function endFlash(){

document.getElementById("flashBtns")
.classList.add("hidden");

document.getElementById("flashEnd")
.classList.remove("hidden");
}



// ---------------- TEST ----------------

function startTest(){

hideAll();

data=[...allData];

wrongTest=[];

document.getElementById("submitBtn")
.classList.remove("hidden");

document.getElementById("testEnd")
.classList.add("hidden");

document.getElementById("testMode")
.classList.remove("hidden");

buildTest();
}


function buildTest(){

const form=document.getElementById("testForm");

form.innerHTML="";

data.forEach((item,idx)=>{

const div=document.createElement("div");

div.className="test-question";

div.innerHTML=`

<div>${idx+1}. ${item.q}</div>

<input data-i="${idx}">

`;

form.appendChild(div);
});
}


function submitTest(){

wrongTest=[];

const inputs=
document.querySelectorAll("#testForm input");

inputs.forEach(input=>{

const i=input.dataset.i;

const user=input.value.trim().toLowerCase();

const real=data[i].a.toLowerCase();


if(user===real && user!==""){

data[i].score++;

input.style.borderColor="green";
}

else{

data[i].score-=2;

wrongTest.push(data[i]);

input.style.borderColor="red";
}

});

save();

document.getElementById("submitBtn")
.classList.add("hidden");

document.getElementById("testEnd")
.classList.remove("hidden");
}



// ---------------- SMART ----------------

let smartQueue=[];
let smartIndex=0;
let redo=false;
let current=null;


function startSmart(){

hideAll();

document.getElementById("smartRetry")
.classList.add("hidden");

document.getElementById("smartInput").style.display="block";

document.getElementById("smartBtn").style.display="block";

document.getElementById("smartMode")
.classList.remove("hidden");

buildSmartQueue();

smartIndex=0;

nextSmart();
}


function buildSmartQueue(){

smartQueue=
allData.filter(q=>q.score<5);

shuffle(smartQueue);
}


function nextSmart(){

redo=false;

document.getElementById("smartAnswer")
.classList.add("hidden");


if(smartIndex>=smartQueue.length){

document.getElementById("smartQ")
.textContent="ğŸ‰ Mastered!";

document.getElementById("smartInput")
.style.display="none";

document.getElementById("smartBtn")
.style.display="none";

document.getElementById("smartRetry")
.classList.remove("hidden");

return;
}


current=smartQueue[smartIndex];

document.getElementById("smartQ")
.textContent=current.q;

document.getElementById("smartInput").value="";
}


function checkSmart(){

const input=
document.getElementById("smartInput")
.value.trim().toLowerCase();

if(!input) return;

const real=current.a.toLowerCase();


// First try
if(!redo){

if(input===real){

correctSound.play();

current.score++;

save();

smartIndex++;

nextSmart();
}

else{

wrongSound.play();

current.score-=2;

save();

redo=true;

document.getElementById("smartAnswer")
.textContent="âŒ Correct: "+current.a;

document.getElementById("smartAnswer")
.classList.remove("hidden");
}

}

// Redo
else{

if(input===real){

correctSound.play();

redo=false;

smartIndex++;

nextSmart();
}

}

}

</script>

</body>
</html>